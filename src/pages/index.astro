---
import Layout from "../layouts/Layout.astro";
import Avatar from "../components/Avatar.astro";
import { Icon } from "astro-icon/components";

import { fetchDiscordStatus } from "../utils/fetchDiscordStatus";

const DISCORD_ID = import.meta.env.DISCORD_ID;

if (!DISCORD_ID) {
  throw new Error(
    "Missing DISCORD_ID environment variable. Did you forget to add it to your .env file?",
  );
}

const {
  data: { discord_user, discord_status },
} = await fetchDiscordStatus(DISCORD_ID);
const { username, global_name, id, avatar } = discord_user;
---

<Layout title="Home - Johannes Andersen">
  <main>
    <h1>
      {global_name} (@{username})
    </h1>

    <Avatar
      id={id}
      avatar={avatar}
      username={global_name}
      status={discord_status}
    />
  </main>

  <footer>
    <a aria-label="Link to my x.com profile" href="https://x.com/johand199">
      <Icon name="x" />
    </a>
    <a
      aria-label="Link to my GitHub provile"
      href="https://github.com/Johannes-Andersen"
    >
      <Icon class="fill-white" name="github" />
    </a>
  </footer>
</Layout>

<style>
  main,
  footer {
    margin: auto;
    padding: 1rem;
    color: white;
    font-size: 20px;
  }

  main {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
  }

  main h1 {
    text-align: center;
  }

  footer {
    display: flex;
    justify-content: center;
    gap: 1rem;
  }
</style>
